# cp2024spb-rzd

[Преобразование каталога товаров ОАО «РЖД»](https://lk.hacks-ai.ru/event/1077380/case)

сабмит находится в /docs/submit.csv

1.	Ссылка на открытый репозиторий с исходным кодом https://github.com/gulldan/cp2024spb-rzd
2.	Ссылка на презентацию - https://docs.google.com/presentation/d/1hzzM9Y2gU5PSEd1upsWY7tCjNrhvxDxbYL_81JLZLf8 
3.	Ссылка на прототип (ссылка на гит/ссылка на облако) - https://github.com/gulldan/cp2024spb-rzd 
4.  Ссылка на иноформацию по кейсу https://lodmedia.hb.bizmrg.com/cases/1144863/%D0%A0%D0%96%D0%94_%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3.zip
5.	Ссылка на датасет https://lodmedia.hb.bizmrg.com/case_files/1144863/train_dataset_train%20%D1%80%D0%B6%D0%B4%20%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3.zip

### Технический отчет

TBD

## Parser

### **Пошаговый алгоритм работы парсера**

1. **Инициализация**:

   - Настраивается логирование для отслеживания процесса выполнения скрипта.
   - Определяются глобальные переменные и списки URL сайтов для поиска.

2. **Чтение данных**:

   - Загружается файл `MTR.parquet` с помощью Polars.
   - Отфильтровываются записи, где поле `'Параметры'` пустое.

3. **Цикл обработки товаров**:

   - Для каждого товара из отфильтрованного списка:
     - Проверяется наличие выходного файла в папке `output`. Если файл уже существует, товар пропускается.
     - Извлекаются `'Наименование'`, `'Маркировка'` и `'код СКМТР'`.
     - Формируется поисковый запрос на основе длины полей `'Наименование'` и `'Маркировка'`.
     - Если поисковый запрос пустой, создается пустой JSON-файл, и скрипт переходит к следующему товару.

4. **Выполнение поиска и сбор ссылок**:

   - Инициализируется браузер с помощью Playwright и настраивается stealth-режим.
   - Выполняется поиск в Google с использованием поискового запроса и ограничением по сайтам.
   - Если результатов нет, выполняется повторный поиск без ограничения по сайтам.
   - Собираются ссылки на первые `n` результатов (по умолчанию 7).

5. **Обработка ссылок**:

   - Каждая ссылка обрабатывается асинхронно:
     - Переход по ссылке с учетом таймаутов.
     - Эмуляция пользовательского взаимодействия для обхода возможных защит на сайте.
     - Извлечение характеристик товара с помощью парсинга контента страницы.
     - Сохранение результатов во временный JSON-файл с именем, включающим `'код СКМТР'` и индекс ссылки.

6. **Объединение результатов**:

   - После обработки всех ссылок характеристики объединяются в один словарь.
   - Используется функция похожести строк из библиотеки rapidfuzz для объединения характеристик с похожими названиями.

7. **Сохранение окончательных данных**:

   - Объединенные характеристики сохраняются в файл JSON в папке `output`, имя файла соответствует `'код СКМТР'`.
   - Если характеристики не найдены, создается пустой JSON-файл.

8. **Очистка и завершение**:

   - Удаляются временные файлы, созданные при обработке ссылок.
   - Закрывается браузер и освобождаются ресурсы.

Более подробная информация лежт в папке parser README.md