# cp2024spb-rzd

## Parser

### **Пошаговый алгоритм работы парсера**

1. **Инициализация**:

   - Настраивается логирование для отслеживания процесса выполнения скрипта.
   - Определяются глобальные переменные и списки URL сайтов для поиска.

2. **Чтение данных**:

   - Загружается файл `MTR.parquet` с помощью Polars.
   - Отфильтровываются записи, где поле `'Параметры'` пустое.

3. **Цикл обработки товаров**:

   - Для каждого товара из отфильтрованного списка:
     - Проверяется наличие выходного файла в папке `output`. Если файл уже существует, товар пропускается.
     - Извлекаются `'Наименование'`, `'Маркировка'` и `'код СКМТР'`.
     - Формируется поисковый запрос на основе длины полей `'Наименование'` и `'Маркировка'`.
     - Если поисковый запрос пустой, создается пустой JSON-файл, и скрипт переходит к следующему товару.

4. **Выполнение поиска и сбор ссылок**:

   - Инициализируется браузер с помощью Playwright и настраивается stealth-режим.
   - Выполняется поиск в Google с использованием поискового запроса и ограничением по сайтам.
   - Если результатов нет, выполняется повторный поиск без ограничения по сайтам.
   - Собираются ссылки на первые `n` результатов (по умолчанию 7).

5. **Обработка ссылок**:

   - Каждая ссылка обрабатывается асинхронно:
     - Переход по ссылке с учетом таймаутов.
     - Эмуляция пользовательского взаимодействия для обхода возможных защит на сайте.
     - Извлечение характеристик товара с помощью парсинга контента страницы.
     - Сохранение результатов во временный JSON-файл с именем, включающим `'код СКМТР'` и индекс ссылки.

6. **Объединение результатов**:

   - После обработки всех ссылок характеристики объединяются в один словарь.
   - Используется функция похожести строк из библиотеки rapidfuzz для объединения характеристик с похожими названиями.

7. **Сохранение окончательных данных**:

   - Объединенные характеристики сохраняются в файл JSON в папке `output`, имя файла соответствует `'код СКМТР'`.
   - Если характеристики не найдены, создается пустой JSON-файл.

8. **Очистка и завершение**:

   - Удаляются временные файлы, созданные при обработке ссылок.
   - Закрывается браузер и освобождаются ресурсы.

Более подробная информация лежт в папке parser README.md